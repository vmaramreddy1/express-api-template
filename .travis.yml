language: node_js
env:
  global:
  - CC_TEST_REPORTER_ID=07e80959299612346f16955db2ffab6d4936b733ba75219ff621782d5043f919
matrix:
  include:
  - node_js: '12'
cache:
  directories:
  - node_modules
install: yarn
after_success: yarn coverage
before_script:
- psql -c 'create database testdb;' -U postgres
- curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64
  > ./cc-test-reporter
- chmod +x ./cc-test-reporter
- "./cc-test-reporter before-build"
script:
- yarn test
after_script:
- "./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESUL"
services:
- postgresql
addons:
  postgresql: '10'
  apt:
    packages:
    - postgresql-10
    - postgresql-client-10
before_install:
- sudo cp /etc/postgresql/{9.6,10}/main/pg_hba.conf
- sudo /etc/init.d/postgresql restart
deploy:
  provider: heroku
  app:
    master: images-backend
  api_key:
    secure: rJF3oJE6xhILpKYtV68rLjrS57+9VhP4oCzgdJMBeDOTwLGO0Ww5HMlZd8L0TjGSGfg0hYKAqMk96AgnyMuK1xLImL1jrqD+QqEx/VEkirKK2yBFctWZIa+rdcZ4ZSgMJvT1YdHno8nA4AQG+VW4FvgOvmBzX7Yl3aTb1T3EoGQsNETK6IRW51WCl0HEZm0XSY4gqn7AvKXqhv5fXBlT2nlo5JbK8bmAgDjlZF83JKJ6CwUTxIPiax5vygUkx4W76kxKGbdIYugg6sWTnAj+CSicTLXIsbpO6V4nviEI1VZTll8BtRo2rU9FnoPvNUvTGTP47IX063GsDK9+W4kTV5jkY4XFIYLWIIjRJcT5csoPMujZWCfHVDjyKlN/OOFGzt/x9mLAXZbO9S44THzEZOGh7NAofzX13Cv7Ur6TMTLlNa9euvJsa/qWyuPiSwAYxa1RjvypVBrsciA+moLZQwJbeaLtTk7IpLOEYGrgrcyKcTzEilj7mLW0iLuyepHpFCwxzARV67mAy4sRC/1sil6/t1U6UgUF2+TKVUAXS5ZAGGW3xaOCQrS4fL0RF1Yqa7uymcl6L/skV6y0qFtWielZqeVYxiFn3kr/T+NWpGRTEwcQhp26GwerwBAD+h9YRnj8W8P371SKzC+/YUhIasuDsrhnssibdCaAolIKL9k=
